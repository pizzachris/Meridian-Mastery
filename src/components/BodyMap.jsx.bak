import React, { useState } from 'react'
import flashcardsData from '../data/flashcards.json'
import { ProgressTracker } from '../utils/progressTracker'

const BodyMap = ({ navigateTo }) => {
  const [selectedRegion, setSelectedRegion] = useState(null)
  const [selectedPoint, setSelectedPoint] = useState(null)
  const [selectedMeridian, setSelectedMeridian] = useState(null)
  const [viewSide, setViewSide] = useState('front') // 'front' or 'back'
  const [showAllPoints, setShowAllPoints] = useState(false) // Show one meridian at a time by default
  const [searchTerm, setSearchTerm] = useState('')
  const [meridianFilter, setMeridianFilter] = useState('Lung') // Start with Lung meridian by default
  // Define body regions with their associated points
  const bodyRegions = {
    'HEAD & NECK': ['head', 'neck', 'face', 'temple', 'forehead', 'chin', 'throat', 'occiput', 'nape'],
    'ARMS': ['arm', 'elbow', 'wrist', 'hand', 'finger', 'shoulder'],
    'TRUNK': ['chest', 'back', 'spine', 'intercostal', 'clavicle', 'scapula', 'thoracic', 'lumbar'],
    'LEGS': ['leg', 'knee', 'thigh', 'calf', 'posterior thigh', 'posterior leg'],
    'FEET': ['foot', 'toe', 'ankle', 'heel']
  }

  // Get meridian colors
  const getMeridianColor = (meridian) => {
    const colors = {
      'Lung': '#e5e7eb',
      'Large Intestine': '#e5e7eb',
      'Stomach': '#fbbf24',
      'Spleen': '#fbbf24',
      'Heart': '#ef4444',
      'Small Intestine': '#ef4444',
      'Urinary Bladder': '#3b82f6',
      'Kidney': '#3b82f6',
      'Pericardium': '#ef4444',
      'Triple Burner': '#ef4444',
      'Gall Bladder': '#10b981',
      'Liver': '#10b981',
      'Governing Vessel': '#8b5cf6',
      'Conception Vessel': '#8b5cf6'
    }
    return colors[meridian] || '#6b7280'
  }
  // Filter points by region
  const getPointsForRegion = (regionName) => {
    const regionKeywords = bodyRegions[regionName] || []
    return flashcardsData.flashcards.filter(card => {
      const location = card.location.toLowerCase()
      const isBackPoint = location.includes('back') || location.includes('spine') || 
                         location.includes('posterior') || location.includes('scapula') ||
                         location.includes('vertebra') || location.includes('occiput') ||
                         card.meridian === 'Bladder' || card.meridian === 'Governing Vessel'
      
      // Show points based on current view (front/back) and region
      const matchesRegion = regionKeywords.some(keyword => location.includes(keyword))
      
      if (viewSide === 'back') {
        return matchesRegion && (isBackPoint || card.meridian === 'Bladder' || card.meridian === 'Governing Vessel')
      } else {
        return matchesRegion && !isBackPoint
      }
    })
  }

  // Get unique meridians for current region
  const getMeridiansForRegion = (regionName) => {
    const points = getPointsForRegion(regionName)
    const meridians = [...new Set(points.map(point => point.meridian))]
    return meridians
  }

  // Get points for selected meridian in current region
  const getPointsForMeridian = (regionName, meridian) => {
    const regionPoints = getPointsForRegion(regionName)
    return regionPoints.filter(point => point.meridian === meridian)
  }

  const handleRegionSelect = (region) => {
    setSelectedRegion(region)
    setSelectedMeridian(null)
    setSelectedPoint(null)
  }

  const handleMeridianSelect = (meridian) => {
    setSelectedMeridian(selectedMeridian === meridian ? null : meridian)
    setSelectedPoint(null)
  }

  const handlePointSelect = (point) => {
    setSelectedPoint(selectedPoint?.id === point.id ? null : point)
  }
  const handleViewPoint = () => {
    if (selectedPoint) {
      // Track progress when viewing a point
      ProgressTracker.viewPoint(selectedPoint.id, selectedPoint.meridian)
      navigateTo('flashcards', { selectedPointId: selectedPoint.id })
    }
  }  // Generate anatomically accurate point positions for all 362 pressure points
  const getAnatomicalPosition = (point) => {
    const pointNumber = point.number
    const location = point.location.toLowerCase()
    const meridian = point.meridian
    
    // Anatomical coordinate mapping based on real acupuncture point locations
    const anatomicalPositions = {
      // LUNG MERIDIAN (LU1-LU11) - Lateral chest to thumb
      'LU1': { front: { x: 46, y: 27 }, back: null }, // 1st intercostal space
      'LU2': { front: { x: 44, y: 25 }, back: null }, // Below clavicle
      'LU3': { front: { x: 40, y: 32 }, back: null }, // Upper arm lateral
      'LU4': { front: { x: 38, y: 35 }, back: null }, // Upper arm
      'LU5': { front: { x: 34, y: 44 }, back: null }, // Elbow crease radial
      'LU6': { front: { x: 32, y: 50 }, back: null }, // Forearm radial
      'LU7': { front: { x: 30, y: 56 }, back: null }, // Wrist radial
      'LU8': { front: { x: 29, y: 58 }, back: null }, // Wrist point
      'LU9': { front: { x: 28, y: 60 }, back: null }, // Wrist crease radial
      'LU10': { front: { x: 27, y: 63 }, back: null }, // Thenar eminence
      'LU11': { front: { x: 26, y: 65 }, back: null }, // Thumb nail point

      // LARGE INTESTINE MERIDIAN (LI1-LI20) - Index finger to nostril
      'LI1': { front: { x: 25, y: 66 }, back: null }, // Index finger nail
      'LI2': { front: { x: 26, y: 65 }, back: null }, // Index finger joint
      'LI3': { front: { x: 27, y: 64 }, back: null }, // Hand dorsum
      'LI4': { front: { x: 28, y: 63 }, back: null }, // Hand web (Hegu)
      'LI5': { front: { x: 29, y: 61 }, back: null }, // Wrist radial
      'LI6': { front: { x: 30, y: 58 }, back: null }, // Forearm
      'LI7': { front: { x: 31, y: 55 }, back: null }, // Forearm
      'LI8': { front: { x: 32, y: 52 }, back: null }, // Forearm
      'LI9': { front: { x: 33, y: 49 }, back: null }, // Forearm
      'LI10': { front: { x: 34, y: 46 }, back: null }, // Forearm
      'LI11': { front: { x: 35, y: 44 }, back: null }, // Elbow lateral (Quchi)
      'LI12': { front: { x: 36, y: 41 }, back: null }, // Upper arm
      'LI13': { front: { x: 37, y: 38 }, back: null }, // Upper arm
      'LI14': { front: { x: 38, y: 35 }, back: null }, // Upper arm
      'LI15': { front: { x: 39, y: 31 }, back: null }, // Shoulder (Jianyu)
      'LI16': { front: { x: 41, y: 28 }, back: null }, // Shoulder
      'LI17': { front: { x: 43, y: 25 }, back: null }, // Neck lateral
      'LI18': { front: { x: 45, y: 23 }, back: null }, // Neck
      'LI19': { front: { x: 47, y: 20 }, back: null }, // Nose lateral
      'LI20': { front: { x: 48, y: 18 }, back: null }, // Nostril (Yingxiang)

      // STOMACH MERIDIAN (ST1-ST45) - Under eye to toe
      'ST1': { front: { x: 49, y: 13 }, back: null }, // Under eye
      'ST2': { front: { x: 49, y: 14 }, back: null }, // Infraorbital
      'ST3': { front: { x: 49, y: 15 }, back: null }, // Cheek
      'ST4': { front: { x: 48, y: 16 }, back: null }, // Mouth corner
      'ST5': { front: { x: 47, y: 18 }, back: null }, // Jaw angle
      'ST6': { front: { x: 46, y: 19 }, back: null }, // Masseter
      'ST7': { front: { x: 48, y: 11 }, back: null }, // Temple
      'ST8': { front: { x: 49, y: 10 }, back: null }, // Temple corner
      'ST9': { front: { x: 49, y: 22 }, back: null }, // Neck carotid
      'ST10': { front: { x: 48, y: 24 }, back: null }, // Throat
      'ST11': { front: { x: 47, y: 25 }, back: null }, // Supraclavicular
      'ST12': { front: { x: 46, y: 26 }, back: null }, // Supraclavicular center
      'ST13': { front: { x: 45, y: 27 }, back: null }, // Below clavicle
      'ST14': { front: { x: 45, y: 28 }, back: null }, // 1st intercostal
      'ST15': { front: { x: 45, y: 30 }, back: null }, // 2nd intercostal
      'ST16': { front: { x: 45, y: 32 }, back: null }, // 3rd intercostal
      'ST17': { front: { x: 45, y: 34 }, back: null }, // Nipple level
      'ST18': { front: { x: 45, y: 36 }, back: null }, // 5th intercostal
      'ST19': { front: { x: 45, y: 38 }, back: null }, // Upper abdomen
      'ST20': { front: { x: 45, y: 40 }, back: null }, // Upper abdomen
      'ST21': { front: { x: 45, y: 42 }, back: null }, // Mid abdomen
      'ST22': { front: { x: 45, y: 44 }, back: null }, // Mid abdomen
      'ST23': { front: { x: 45, y: 46 }, back: null }, // Mid abdomen
      'ST24': { front: { x: 45, y: 48 }, back: null }, // Lower abdomen
      'ST25': { front: { x: 45, y: 50 }, back: null }, // Navel lateral (Tianshu)
      'ST26': { front: { x: 45, y: 52 }, back: null }, // Lower abdomen
      'ST27': { front: { x: 45, y: 54 }, back: null }, // Lower abdomen
      'ST28': { front: { x: 45, y: 56 }, back: null }, // Lower abdomen
      'ST29': { front: { x: 45, y: 58 }, back: null }, // Lower abdomen
      'ST30': { front: { x: 45, y: 60 }, back: null }, // Inguinal region
      'ST31': { front: { x: 44, y: 62 }, back: null }, // Hip region
      'ST32': { front: { x: 44, y: 65 }, back: null }, // Anterior thigh
      'ST33': { front: { x: 44, y: 68 }, back: null }, // Anterior thigh
      'ST34': { front: { x: 44, y: 71 }, back: null }, // Anterior thigh
      'ST35': { front: { x: 44, y: 74 }, back: null }, // Knee lateral
      'ST36': { front: { x: 43, y: 77 }, back: null }, // Below knee (Zusanli)
      'ST37': { front: { x: 43, y: 80 }, back: null }, // Anterior leg
      'ST38': { front: { x: 43, y: 83 }, back: null }, // Anterior leg
      'ST39': { front: { x: 43, y: 86 }, back: null }, // Anterior leg
      'ST40': { front: { x: 43, y: 89 }, back: null }, // Anterior leg
      'ST41': { front: { x: 43, y: 92 }, back: null }, // Ankle
      'ST42': { front: { x: 42, y: 95 }, back: null }, // Foot dorsum
      'ST43': { front: { x: 41, y: 98 }, back: null }, // Foot dorsum
      'ST44': { front: { x: 40, y: 101 }, back: null }, // Foot dorsum
      'ST45': { front: { x: 39, y: 104 }, back: null }, // 2nd toe

      // SPLEEN MERIDIAN (SP1-SP21) - Big toe to armpit
      'SP1': { front: { x: 36, y: 106 }, back: null }, // Big toe nail
      'SP2': { front: { x: 37, y: 105 }, back: null }, // Big toe joint
      'SP3': { front: { x: 38, y: 104 }, back: null }, // Foot medial
      'SP4': { front: { x: 39, y: 102 }, back: null }, // Foot arch
      'SP5': { front: { x: 40, y: 100 }, back: null }, // Foot medial
      'SP6': { front: { x: 41, y: 95 }, back: null }, // Ankle medial (Sanyinjiao)
      'SP7': { front: { x: 42, y: 92 }, back: null }, // Leg medial
      'SP8': { front: { x: 43, y: 89 }, back: null }, // Leg medial
      'SP9': { front: { x: 44, y: 86 }, back: null }, // Knee medial
      'SP10': { front: { x: 45, y: 83 }, back: null }, // Thigh medial (Xuehai)
      'SP11': { front: { x: 46, y: 80 }, back: null }, // Thigh medial
      'SP12': { front: { x: 47, y: 77 }, back: null }, // Inguinal region
      'SP13': { front: { x: 48, y: 74 }, back: null }, // Lower abdomen
      'SP14': { front: { x: 48, y: 71 }, back: null }, // Lower abdomen
      'SP15': { front: { x: 48, y: 68 }, back: null }, // Abdomen lateral
      'SP16': { front: { x: 48, y: 65 }, back: null }, // Abdomen lateral
      'SP17': { front: { x: 48, y: 62 }, back: null }, // Lower chest
      'SP18': { front: { x: 48, y: 59 }, back: null }, // Lower chest
      'SP19': { front: { x: 48, y: 56 }, back: null }, // Lower chest
      'SP20': { front: { x: 48, y: 53 }, back: null }, // Mid chest
      'SP21': { front: { x: 48, y: 50 }, back: null }, // Lateral chest

      // HEART MERIDIAN (HT1-HT9) - Armpit to little finger
      'HT1': { front: { x: 65, y: 30 }, back: null }, // Armpit center
      'HT2': { front: { x: 66, y: 33 }, back: null }, // Upper arm medial
      'HT3': { front: { x: 67, y: 36 }, back: null }, // Upper arm medial
      'HT4': { front: { x: 68, y: 39 }, back: null }, // Upper arm medial
      'HT5': { front: { x: 69, y: 42 }, back: null }, // Upper arm medial
      'HT6': { front: { x: 70, y: 45 }, back: null }, // Forearm medial
      'HT7': { front: { x: 71, y: 48 }, back: null }, // Wrist crease (Shenmen)
      'HT8': { front: { x: 72, y: 51 }, back: null }, // Palm
      'HT9': { front: { x: 73, y: 54 }, back: null }, // Little finger nail

      // SMALL INTESTINE MERIDIAN (SI1-SI19) - Little finger to ear
      'SI1': { front: { x: 74, y: 66 }, back: null }, // Little finger nail
      'SI2': { front: { x: 73, y: 65 }, back: null }, // Little finger joint
      'SI3': { front: { x: 72, y: 64 }, back: null }, // Hand ulnar
      'SI4': { front: { x: 71, y: 62 }, back: null }, // Wrist ulnar
      'SI5': { front: { x: 70, y: 60 }, back: null }, // Wrist ulnar
      'SI6': { front: { x: 69, y: 58 }, back: null }, // Forearm ulnar
      'SI7': { front: { x: 68, y: 55 }, back: null }, // Forearm ulnar
      'SI8': { front: { x: 67, y: 52 }, back: null }, // Elbow medial
      'SI9': { front: null, back: { x: 33, y: 35 } }, // Shoulder posterior
      'SI10': { front: null, back: { x: 35, y: 32 } }, // Shoulder blade
      'SI11': { front: null, back: { x: 37, y: 30 } }, // Scapula center
      'SI12': { front: null, back: { x: 39, y: 28 } }, // Scapula
      'SI13': { front: null, back: { x: 41, y: 26 } }, // Scapula medial
      'SI14': { front: null, back: { x: 43, y: 24 } }, // Scapula upper
      'SI15': { front: null, back: { x: 45, y: 22 } }, // Upper back
      'SI16': { front: null, back: { x: 47, y: 20 } }, // Neck posterior
      'SI17': { front: { x: 52, y: 18 }, back: { x: 48, y: 18 } }, // Neck lateral
      'SI18': { front: { x: 53, y: 15 }, back: null }, // Cheek
      'SI19': { front: { x: 52, y: 12 }, back: null }, // Ear front

      // BLADDER MERIDIAN (BL1-BL67) - Eye to little toe (mainly back)
      'BL1': { front: { x: 48, y: 11 }, back: null }, // Inner eye corner
      'BL2': { front: { x: 49, y: 9 }, back: null }, // Eyebrow inner
      'BL3': { front: null, back: { x: 48, y: 8 } }, // Forehead
      'BL4': { front: null, back: { x: 49, y: 7 } }, // Forehead
      'BL5': { front: null, back: { x: 50, y: 6 } }, // Forehead center
      'BL6': { front: null, back: { x: 51, y: 7 } }, // Forehead
      'BL7': { front: null, back: { x: 52, y: 8 } }, // Head top
      'BL8': { front: null, back: { x: 51, y: 9 } }, // Head top
      'BL9': { front: null, back: { x: 50, y: 10 } }, // Head posterior
      'BL10': { front: null, back: { x: 49, y: 12 } }, // Neck posterior (Tianzhu)
      'BL11': { front: null, back: { x: 47, y: 16 } }, // 1st thoracic
      'BL12': { front: null, back: { x: 47, y: 18 } }, // 2nd thoracic
      'BL13': { front: null, back: { x: 47, y: 20 } }, // 3rd thoracic (Feishu)
      'BL14': { front: null, back: { x: 47, y: 22 } }, // 4th thoracic
      'BL15': { front: null, back: { x: 47, y: 24 } }, // 5th thoracic (Xinshu)
      'BL16': { front: null, back: { x: 47, y: 26 } }, // 6th thoracic
      'BL17': { front: null, back: { x: 47, y: 28 } }, // 7th thoracic (Geshu)
      'BL18': { front: null, back: { x: 47, y: 30 } }, // 9th thoracic (Ganshu)
      'BL19': { front: null, back: { x: 47, y: 32 } }, // 10th thoracic (Danshu)
      'BL20': { front: null, back: { x: 47, y: 34 } }, // 11th thoracic (Pishu)
      'BL21': { front: null, back: { x: 47, y: 36 } }, // 12th thoracic (Weishu)
      'BL22': { front: null, back: { x: 47, y: 38 } }, // 1st lumbar
      'BL23': { front: null, back: { x: 47, y: 40 } }, // 2nd lumbar (Shenshu)
      'BL24': { front: null, back: { x: 47, y: 42 } }, // 3rd lumbar
      'BL25': { front: null, back: { x: 47, y: 44 } }, // 4th lumbar
      'BL26': { front: null, back: { x: 47, y: 46 } }, // 5th lumbar
      'BL27': { front: null, back: { x: 47, y: 48 } }, // 1st sacral
      'BL28': { front: null, back: { x: 47, y: 50 } }, // 2nd sacral
      'BL29': { front: null, back: { x: 47, y: 52 } }, // 3rd sacral
      'BL30': { front: null, back: { x: 47, y: 54 } }, // 4th sacral
      'BL31': { front: null, back: { x: 49, y: 48 } }, // Sacral foramen 1
      'BL32': { front: null, back: { x: 49, y: 50 } }, // Sacral foramen 2
      'BL33': { front: null, back: { x: 49, y: 52 } }, // Sacral foramen 3
      'BL34': { front: null, back: { x: 49, y: 54 } }, // Sacral foramen 4
      'BL35': { front: null, back: { x: 50, y: 56 } }, // Coccyx lateral
      'BL36': { front: null, back: { x: 45, y: 58 } }, // Gluteal region
      'BL37': { front: null, back: { x: 44, y: 62 } }, // Posterior thigh
      'BL38': { front: null, back: { x: 43, y: 66 } }, // Posterior thigh
      'BL39': { front: null, back: { x: 42, y: 70 } }, // Popliteal fossa
      'BL40': { front: null, back: { x: 42, y: 74 } }, // Knee posterior center (Weizhong)
      'BL41': { front: null, back: { x: 53, y: 16 } }, // 2nd thoracic lateral
      'BL42': { front: null, back: { x: 53, y: 18 } }, // 3rd thoracic lateral
      'BL43': { front: null, back: { x: 53, y: 20 } }, // 4th thoracic lateral
      'BL44': { front: null, back: { x: 53, y: 22 } }, // 5th thoracic lateral
      'BL45': { front: null, back: { x: 53, y: 24 } }, // 6th thoracic lateral
      'BL46': { front: null, back: { x: 53, y: 26 } }, // 7th thoracic lateral
      'BL47': { front: null, back: { x: 53, y: 28 } }, // 9th thoracic lateral
      'BL48': { front: null, back: { x: 53, y: 30 } }, // 10th thoracic lateral
      'BL49': { front: null, back: { x: 53, y: 32 } }, // 11th thoracic lateral
      'BL50': { front: null, back: { x: 53, y: 34 } }, // 12th thoracic lateral
      'BL51': { front: null, back: { x: 53, y: 36 } }, // 1st lumbar lateral
      'BL52': { front: null, back: { x: 53, y: 38 } }, // 2nd lumbar lateral
      'BL53': { front: null, back: { x: 53, y: 40 } }, // 3rd lumbar lateral
      'BL54': { front: null, back: { x: 53, y: 42 } }, // 4th lumbar lateral
      'BL55': { front: null, back: { x: 41, y: 78 } }, // Posterior leg
      'BL56': { front: null, back: { x: 41, y: 82 } }, // Posterior leg
      'BL57': { front: null, back: { x: 41, y: 86 } }, // Posterior leg (Chengshan)
      'BL58': { front: null, back: { x: 40, y: 90 } }, // Posterior leg
      'BL59': { front: null, back: { x: 39, y: 94 } }, // Ankle lateral
      'BL60': { front: null, back: { x: 38, y: 98 } }, // Ankle posterior (Kunlun)
      'BL61': { front: null, back: { x: 37, y: 102 } }, // Heel region
      'BL62': { front: null, back: { x: 36, y: 106 } }, // Ankle lateral
      'BL63': { front: null, back: { x: 35, y: 110 } }, // Foot lateral
      'BL64': { front: null, back: { x: 34, y: 112 } }, // Foot lateral
      'BL65': { front: null, back: { x: 33, y: 114 } }, // Foot lateral
      'BL66': { front: null, back: { x: 32, y: 115 } }, // 5th toe joint
      'BL67': { front: null, back: { x: 31, y: 116 } }, // 5th toe nail

      // KIDNEY MERIDIAN (KI1-KI27) - Sole to chest
      'KI1': { front: { x: 40, y: 110 }, back: null }, // Sole center (Yongquan)
      'KI2': { front: { x: 41, y: 108 }, back: null }, // Foot medial
      'KI3': { front: { x: 42, y: 106 }, back: null }, // Ankle medial (Taixi)
      'KI4': { front: { x: 42, y: 104 }, back: null }, // Heel medial
      'KI5': { front: { x: 42, y: 102 }, back: null }, // Ankle medial
      'KI6': { front: { x: 42, y: 100 }, back: null }, // Below medial malleolus
      'KI7': { front: { x: 43, y: 98 }, back: null }, // Leg medial
      'KI8': { front: { x: 44, y: 96 }, back: null }, // Leg medial
      'KI9': { front: { x: 45, y: 94 }, back: null }, // Leg medial
      'KI10': { front: { x: 46, y: 92 }, back: null }, // Knee medial
      'KI11': { front: { x: 47, y: 85 }, back: null }, // Pubic region
      'KI12': { front: { x: 47, y: 82 }, back: null }, // Lower abdomen
      'KI13': { front: { x: 47, y: 78 }, back: null }, // Lower abdomen
      'KI14': { front: { x: 47, y: 75 }, back: null }, // Lower abdomen
      'KI15': { front: { x: 47, y: 72 }, back: null }, // Lower abdomen
      'KI16': { front: { x: 47, y: 68 }, back: null }, // Abdomen
      'KI17': { front: { x: 47, y: 65 }, back: null }, // Abdomen
      'KI18': { front: { x: 47, y: 62 }, back: null }, // Abdomen
      'KI19': { front: { x: 47, y: 58 }, back: null }, // Upper abdomen
      'KI20': { front: { x: 47, y: 55 }, back: null }, // Upper abdomen
      'KI21': { front: { x: 47, y: 52 }, back: null }, // Upper abdomen
      'KI22': { front: { x: 47, y: 48 }, back: null }, // Lower chest
      'KI23': { front: { x: 47, y: 45 }, back: null }, // Lower chest
      'KI24': { front: { x: 47, y: 42 }, back: null }, // Lower chest
      'KI25': { front: { x: 47, y: 38 }, back: null }, // Lower chest
      'KI26': { front: { x: 47, y: 35 }, back: null }, // Lower chest
      'KI27': { front: { x: 47, y: 32 }, back: null }, // Below clavicle

      // PERICARDIUM MERIDIAN (PC1-PC9) - Chest to middle finger
      'PC1': { front: { x: 52, y: 35 }, back: null }, // Lateral nipple
      'PC2': { front: { x: 62, y: 32 }, back: null }, // Armpit
      'PC3': { front: { x: 64, y: 36 }, back: null }, // Upper arm medial
      'PC4': { front: { x: 66, y: 40 }, back: null }, // Upper arm medial
      'PC5': { front: { x: 68, y: 44 }, back: null }, // Forearm medial
      'PC6': { front: { x: 70, y: 48 }, back: null }, // Forearm medial (Neiguan)
      'PC7': { front: { x: 71, y: 52 }, back: null }, // Wrist center (Daling)
      'PC8': { front: { x: 72, y: 56 }, back: null }, // Palm center (Laogong)
      'PC9': { front: { x: 73, y: 60 }, back: null }, // Middle finger nail

      // TRIPLE HEATER MERIDIAN (TH1-TH23) - Ring finger to eyebrow
      'TH1': { front: { x: 74, y: 64 }, back: null }, // Ring finger nail
      'TH2': { front: { x: 73, y: 62 }, back: null }, // Ring finger joint
      'TH3': { front: { x: 72, y: 60 }, back: null }, // Hand dorsum
      'TH4': { front: { x: 71, y: 58 }, back: null }, // Wrist dorsum
      'TH5': { front: { x: 70, y: 56 }, back: null }, // Forearm dorsum
      'TH6': { front: { x: 69, y: 54 }, back: null }, // Forearm dorsum
      'TH7': { front: { x: 68, y: 52 }, back: null }, // Forearm dorsum
      'TH8': { front: { x: 67, y: 50 }, back: null }, // Forearm dorsum
      'TH9': { front: { x: 66, y: 48 }, back: null }, // Forearm dorsum
      'TH10': { front: { x: 65, y: 46 }, back: null }, // Elbow posterior
      'TH11': { front: null, back: { x: 67, y: 35 } }, // Upper arm posterior
      'TH12': { front: null, back: { x: 65, y: 32 } }, // Upper arm posterior
      'TH13': { front: null, back: { x: 63, y: 30 } }, // Shoulder posterior
      'TH14': { front: null, back: { x: 61, y: 28 } }, // Shoulder top
      'TH15': { front: null, back: { x: 59, y: 26 } }, // Shoulder
      'TH16': { front: null, back: { x: 57, y: 24 } }, // Neck lateral
      'TH17': { front: { x: 54, y: 16 }, back: { x: 55, y: 22 } }, // Ear mastoid
      'TH18': { front: { x: 54, y: 14 }, back: null }, // Ear posterior
      'TH19': { front: { x: 53, y: 12 }, back: null }, // Ear superior
      'TH20': { front: { x: 52, y: 10 }, back: null }, // Ear apex
      'TH21': { front: { x: 51, y: 11 }, back: null }, // Ear front
      'TH22': { front: { x: 50, y: 12 }, back: null }, // Ear tragus
      'TH23': { front: { x: 52, y: 9 }, back: null }, // Eyebrow lateral (Sizhukong)

      // GALLBLADDER MERIDIAN (GB1-GB44) - Eye corner to 4th toe
      'GB1': { front: { x: 52, y: 11 }, back: null }, // Outer eye corner
      'GB2': { front: { x: 53, y: 13 }, back: null }, // Ear front
      'GB3': { front: { x: 54, y: 11 }, back: null }, // Temple
      'GB4': { front: { x: 55, y: 9 }, back: null }, // Temple
      'GB5': { front: { x: 56, y: 8 }, back: null }, // Temple
      'GB6': { front: { x: 55, y: 10 }, back: null }, // Temple
      'GB7': { front: { x: 54, y: 12 }, back: null }, // Temple
      'GB8': { front: { x: 53, y: 8 }, back: null }, // Temple superior
      'GB9': { front: null, back: { x: 54, y: 7 } }, // Head lateral
      'GB10': { front: null, back: { x: 55, y: 9 } }, // Head posterior
      'GB11': { front: null, back: { x: 56, y: 11 } }, // Head posterior
      'GB12': { front: null, back: { x: 57, y: 13 } }, // Head posterior
      'GB13': { front: { x: 56, y: 7 }, back: null }, // Head lateral
      'GB14': { front: { x: 51, y: 9 }, back: null }, // Forehead
      'GB15': { front: null, back: { x: 54, y: 6 } }, // Head top
      'GB16': { front: null, back: { x: 55, y: 8 } }, // Head posterior
      'GB17': { front: null, back: { x: 56, y: 10 } }, // Head posterior
      'GB18': { front: null, back: { x: 57, y: 12 } }, // Head posterior
      'GB19': { front: null, back: { x: 58, y: 14 } }, // Head posterior
      'GB20': { front: null, back: { x: 52, y: 16 } }, // Neck posterior (Fengchi)
      'GB21': { front: null, back: { x: 55, y: 20 } }, // Shoulder (Jianjing)
      'GB22': { front: { x: 58, y: 32 }, back: null }, // Lateral chest
      'GB23': { front: { x: 57, y: 35 }, back: null }, // Lateral chest
      'GB24': { front: { x: 56, y: 38 }, back: null }, // Lower chest
      'GB25': { front: { x: 55, y: 42 }, back: null }, // Lateral abdomen
      'GB26': { front: { x: 54, y: 46 }, back: null }, // Lateral abdomen
      'GB27': { front: { x: 53, y: 50 }, back: null }, // Iliac crest
      'GB28': { front: { x: 52, y: 54 }, back: null }, // Iliac crest
      'GB29': { front: { x: 51, y: 58 }, back: null }, // Hip region
      'GB30': { front: null, back: { x: 52, y: 60 } }, // Hip posterior (Huantiao)
      'GB31': { front: { x: 50, y: 68 }, back: null }, // Lateral thigh
      'GB32': { front: { x: 49, y: 72 }, back: null }, // Lateral thigh
      'GB33': { front: { x: 48, y: 76 }, back: null }, // Knee lateral
      'GB34': { front: { x: 47, y: 80 }, back: null }, // Below knee lateral (Yanglingquan)
      'GB35': { front: { x: 46, y: 84 }, back: null }, // Lateral leg
      'GB36': { front: { x: 45, y: 88 }, back: null }, // Lateral leg
      'GB37': { front: { x: 44, y: 92 }, back: null }, // Lateral leg
      'GB38': { front: { x: 43, y: 96 }, back: null }, // Lateral leg
      'GB39': { front: { x: 42, y: 100 }, back: null }, // Ankle lateral (Xuanzhong)
      'GB40': { front: { x: 41, y: 104 }, back: null }, // Ankle anterior
      'GB41': { front: { x: 40, y: 108 }, back: null }, // Foot dorsum
      'GB42': { front: { x: 39, y: 110 }, back: null }, // Foot dorsum
      'GB43': { front: { x: 38, y: 112 }, back: null }, // Foot dorsum
      'GB44': { front: { x: 37, y: 114 }, back: null }, // 4th toe nail

      // LIVER MERIDIAN (LR1-LR14) - Big toe to chest
      'LR1': { front: { x: 35, y: 115 }, back: null }, // Big toe nail lateral
      'LR2': { front: { x: 36, y: 113 }, back: null }, // Big toe joint
      'LR3': { front: { x: 37, y: 111 }, back: null }, // Foot dorsum (Taichong)
      'LR4': { front: { x: 38, y: 109 }, back: null }, // Foot medial
      'LR5': { front: { x: 39, y: 107 }, back: null }, // Foot medial
      'LR6': { front: { x: 40, y: 105 }, back: null }, // Ankle medial
      'LR7': { front: { x: 41, y: 103 }, back: null }, // Leg medial
      'LR8': { front: { x: 42, y: 101 }, back: null }, // Knee medial
      'LR9': { front: { x: 43, y: 98 }, back: null }, // Thigh medial
      'LR10': { front: { x: 44, y: 95 }, back: null }, // Thigh medial
      'LR11': { front: { x: 45, y: 92 }, back: null }, // Pubic region
      'LR12': { front: { x: 46, y: 88 }, back: null }, // Inguinal region
      'LR13': { front: { x: 47, y: 85 }, back: null }, // Lower abdomen
      'LR14': { front: { x: 48, y: 82 }, back: null }, // Lower chest

      // GOVERNING VESSEL (GV1-GV28) - Spine posterior
      'GV1': { front: null, back: { x: 50, y: 58 } }, // Coccyx tip
      'GV2': { front: null, back: { x: 50, y: 55 } }, // Sacrococcygeal
      'GV3': { front: null, back: { x: 50, y: 52 } }, // 4th lumbar (Yaoyangguan)
      'GV4': { front: null, back: { x: 50, y: 48 } }, // 2nd lumbar (Mingmen)
      'GV5': { front: null, back: { x: 50, y: 45 } }, // 1st lumbar
      'GV6': { front: null, back: { x: 50, y: 42 } }, // 11th thoracic
      'GV7': { front: null, back: { x: 50, y: 38 } }, // 10th thoracic
      'GV8': { front: null, back: { x: 50, y: 35 } }, // 9th thoracic
      'GV9': { front: null, back: { x: 50, y: 32 } }, // 7th thoracic (Zhiyang)
      'GV10': { front: null, back: { x: 50, y: 28 } }, // 6th thoracic
      'GV11': { front: null, back: { x: 50, y: 25 } }, // 5th thoracic (Shendao)
      'GV12': { front: null, back: { x: 50, y: 22 } }, // 3rd thoracic (Shenzhu)
      'GV13': { front: null, back: { x: 50, y: 18 } }, // 1st thoracic
      'GV14': { front: null, back: { x: 50, y: 15 } }, // 7th cervical (Dazhui)
      'GV15': { front: null, back: { x: 50, y: 13 } }, // 1st cervical
      'GV16': { front: null, back: { x: 50, y: 11 } }, // Occiput (Fengfu)
      'GV17': { front: null, back: { x: 50, y: 9 } }, // Occiput
      'GV18': { front: null, back: { x: 50, y: 7 } }, // Head top
      'GV19': { front: null, back: { x: 50, y: 5 } }, // Head top
      'GV20': { front: { x: 50, y: 5 }, back: { x: 50, y: 3 } }, // Head vertex (Baihui)
      'GV21': { front: { x: 50, y: 6 }, back: null }, // Forehead
      'GV22': { front: { x: 50, y: 7 }, back: null }, // Forehead
      'GV23': { front: { x: 50, y: 8 }, back: null }, // Forehead
      'GV24': { front: { x: 50, y: 9 }, back: null }, // Forehead
      'GV25': { front: { x: 50, y: 11 }, back: null }, // Nose tip
      'GV26': { front: { x: 50, y: 13 }, back: null }, // Philtrum (Renzhong)
      'GV27': { front: { x: 50, y: 15 }, back: null }, // Upper lip
      'GV28': { front: { x: 50, y: 17 }, back: null }, // Gum center

      // CONCEPTION VESSEL (CV1-CV24) - Perineum to lip
      'CV1': { front: { x: 50, y: 85 }, back: null }, // Perineum
      'CV2': { front: { x: 50, y: 82 }, back: null }, // Pubic bone
      'CV3': { front: { x: 50, y: 78 }, back: null }, // Lower abdomen (Zhongji)
      'CV4': { front: { x: 50, y: 75 }, back: null }, // Lower abdomen (Guanyuan)
      'CV5': { front: { x: 50, y: 72 }, back: null }, // Lower abdomen
      'CV6': { front: { x: 50, y: 68 }, back: null }, // Lower abdomen (Qihai)
      'CV7': { front: { x: 50, y: 65 }, back: null }, // Lower abdomen
      'CV8': { front: { x: 50, y: 62 }, back: null }, // Navel (Shenque)
      'CV9': { front: { x: 50, y: 58 }, back: null }, // Upper abdomen
      'CV10': { front: { x: 50, y: 55 }, back: null }, // Upper abdomen
      'CV11': { front: { x: 50, y: 52 }, back: null }, // Upper abdomen
      'CV12': { front: { x: 50, y: 48 }, back: null }, // Upper abdomen (Zhongwan)
      'CV13': { front: { x: 50, y: 45 }, back: null }, // Upper abdomen
      'CV14': { front: { x: 50, y: 42 }, back: null }, // Lower chest (Juque)
      'CV15': { front: { x: 50, y: 38 }, back: null }, // Lower chest
      'CV16': { front: { x: 50, y: 35 }, back: null }, // Lower chest
      'CV17': { front: { x: 50, y: 32 }, back: null }, // Chest center (Shanzhong)
      'CV18': { front: { x: 50, y: 28 }, back: null }, // Upper chest
      'CV19': { front: { x: 50, y: 25 }, back: null }, // Upper chest
      'CV20': { front: { x: 50, y: 22 }, back: null }, // Upper chest
      'CV21': { front: { x: 50, y: 20 }, back: null }, // Throat
      'CV22': { front: { x: 50, y: 18 }, back: null }, // Throat (Tiantu)
      'CV23': { front: { x: 50, y: 16 }, back: null }, // Throat
      'CV24': { front: { x: 50, y: 14 }, back: null } // Lower lip center
    }

    const currentView = viewSide
    const position = anatomicalPositions[pointNumber]
    
    if (!position) {
      // Fallback for any unmapped points
      return currentView === 'front' 
        ? { x: 50 + Math.random() * 10 - 5, y: 50 + Math.random() * 10 - 5 }
        : { x: 50 + Math.random() * 10 - 5, y: 50 + Math.random() * 10 - 5 }
    }

    if (currentView === 'front' && position.front) {
      return position.front
    } else if (currentView === 'back' && position.back) {
      return position.back
    }
    
    return null // Point not visible in current view
  }

  // Get all pressure points for the current view
  const getAllPressurePoints = () => {
    return flashcardsData.flashcards.filter(point => {
      const position = getAnatomicalPosition(point)
      return position !== null // Only include points visible in current view
    })
  }
  return (
    <div className="min-h-screen bg-black text-white">
      <div className="container mx-auto px-4 py-8 max-w-6xl">
        {/* Header with Logo */}
        <header className="text-center mb-8">
          <button 
            onClick={() => navigateTo('home')}
            className="inline-block mb-4 text-yellow-400 hover:text-yellow-300 text-sm font-medium"
          >
            ← Back to Home
          </button>
          
          {/* Logo and Title */}
          <div className="flex items-center justify-center mb-6">
            <div className="w-16 h-16 bg-gradient-to-br from-red-800 to-red-900 rounded-full flex items-center justify-center border-2 border-yellow-500 mr-4">
              {/* Triple spiral logo */}
              <div className="relative">
                <div className="w-8 h-8 border-2 border-yellow-400 rounded-full"></div>
                <div className="absolute inset-1 border border-yellow-400/60 rounded-full"></div>
                <div className="absolute inset-2 border border-yellow-400/30 rounded-full"></div>
              </div>
            </div>
            <div className="text-left">
              <h1 className="text-2xl font-bold text-white">EXPLORE</h1>
              <h2 className="text-xl text-gray-300">BODY MAP</h2>
            </div>
          </div>
        </header>

        {/* Main Layout: Vertical Meridian Selector + Body Map */}
        <div className="flex gap-6">
          {/* LEFT SIDE: Vertical Meridian Selector */}
          <div className="w-64 space-y-4">
            <div className="bg-gray-900 rounded-lg p-4 border border-yellow-600">
              <h3 className="text-lg font-semibold text-yellow-400 mb-4">Select Meridian:</h3>
              
              {/* Meridian Selection Buttons */}
              <div className="space-y-2">
                {[
                  { name: 'Lung', code: 'LU1-LU11', count: 11 },
                  { name: 'Large Intestine', code: 'LI1-LI20', count: 20 },
                  { name: 'Stomach', code: 'ST1-ST45', count: 45 },
                  { name: 'Spleen', code: 'SP1-SP21', count: 21 },
                  { name: 'Heart', code: 'HT1-HT9', count: 9 },
                  { name: 'Small Intestine', code: 'SI1-SI19', count: 19 },
                  { name: 'Bladder', code: 'BL1-BL67', count: 67 },
                  { name: 'Kidney', code: 'KI1-KI27', count: 27 },
                  { name: 'Pericardium', code: 'PC1-PC9', count: 9 },
                  { name: 'Triple Heater', code: 'TH1-TH23', count: 23 },
                  { name: 'Gall Bladder', code: 'GB1-GB44', count: 44 },
                  { name: 'Liver', code: 'LR1-LR14', count: 14 },
                  { name: 'Governing Vessel', code: 'GV1-GV28', count: 28 },
                  { name: 'Conception Vessel', code: 'CV1-CV24', count: 24 }
                ].map((meridian) => {
                  const isSelected = meridianFilter === meridian.name
                  return (
                    <button
                      key={meridian.name}
                      onClick={() => setMeridianFilter(meridian.name)}
                      className={`w-full py-3 px-4 rounded-lg border transition-all duration-200 text-left ${
                        isSelected
                          ? 'border-yellow-400 bg-yellow-900/30 text-yellow-400'
                          : 'border-gray-600 bg-gray-800 text-gray-300 hover:bg-gray-700'
                      }`}
                    >
                      <div className="flex justify-between items-center">
                        <div>
                          <div className="font-medium">{meridian.name}</div>
                          <div className="text-xs opacity-75">{meridian.code}</div>
                        </div>
                        <div className="flex items-center gap-2">
                          <span className="text-xs bg-gray-700 px-2 py-1 rounded">
                            {meridian.count}
                          </span>
                          <span 
                            className="w-3 h-3 rounded-full" 
                            style={{ backgroundColor: getMeridianColor(meridian.name) }}
                          ></span>
                        </div>
                      </div>
                    </button>
                  )
                })}
              </div>
              
              {/* Search Box */}
              <div className="mt-4 pt-4 border-t border-gray-700">
                <input
                  type="text"
                  placeholder="Search points (e.g., LU1, Yintang, etc.)"
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  className="w-full bg-gray-800 border border-gray-600 text-white px-3 py-2 rounded text-sm"
                />
              </div>
              
              {/* Point Count Display */}              <div className="mt-3 text-center text-sm text-gray-300">
                Displaying {getAllPressurePoints().length} anatomically accurate pressure points
              </div>
            </div>
          </div>

          {/* RIGHT SIDE: Body Map and Controls */}
          <div className="flex-1">
            {!selectedRegion ? (
              // Region Selection View with Enhanced Body Model
              <div className="space-y-4">
                <div className="relative bg-gray-900 rounded-lg p-6 border border-yellow-600">
                  {/* Front/Back Toggle */}
                  <div className="flex justify-center mb-4">
                    <div className="bg-gray-800 rounded-lg p-1 flex">
                      <button
                        onClick={() => setViewSide('front')}
                        className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${
                          viewSide === 'front' 
                            ? 'bg-yellow-600 text-black' 
                            : 'text-gray-300 hover:text-white'
                        }`}
                      >
                        FRONT
                      </button>
                      <button
                        onClick={() => setViewSide('back')}
                        className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${
                          viewSide === 'back' 
                            ? 'bg-yellow-600 text-black' 
                            : 'text-gray-300 hover:text-white'
                        }`}
                      >
                        BACK
                      </button>
                    </div>
                  </div>

                  {/* Enhanced Anatomical Body Diagram - WIDER PROPORTIONS */}
                  <svg viewBox="0 0 140 130" className="w-full h-96 mx-auto">
                    {viewSide === 'front' ? (
                      <g>
                        {/* FRONT VIEW - Enhanced with wider arms and legs */}
                        {/* Head with more detail */}
                        <ellipse cx="70" cy="12" rx="9" ry="11" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                        
                        {/* Hair detail */}
                        <path d="M 61 6 Q 70 3 79 6 Q 79 10 77 14 L 63 14 Q 61 10 61 6" 
                              fill="#654321" stroke="#D4AF37" strokeWidth="0.5"/>
                        
                        {/* Facial features */}
                        <circle cx="65" cy="10" r="1" fill="#8B4513"/>
                        <circle cx="75" cy="10" r="1" fill="#8B4513"/>
                        <path d="M 67 15 Q 70 17 73 15" stroke="#8B4513" strokeWidth="0.5" fill="none"/>
                        
                        {/* Neck */}
                        <rect x="66" y="22" width="8" height="6" rx="3" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.3"/>
                        
                        {/* Enhanced torso */}
                        <path d="M 58 28 Q 55 35 56 45 Q 57 58 60 68 L 80 68 Q 83 58 84 45 Q 85 35 82 28 Z" 
                              fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                        
                        {/* Ribcage detail */}
                        <path d="M 60 32 Q 70 30 80 32" stroke="#B8860B" strokeWidth="0.3" fill="none" opacity="0.6"/>
                        <path d="M 61 36 Q 70 34 79 36" stroke="#B8860B" strokeWidth="0.3" fill="none" opacity="0.6"/>
                        <path d="M 61 40 Q 70 38 79 40" stroke="#B8860B" strokeWidth="0.3" fill="none" opacity="0.6"/>
                        
                        {/* Sternum line */}
                        <line x1="70" y1="28" x2="70" y2="58" stroke="#B8860B" strokeWidth="0.4" opacity="0.7"/>
                        
                        {/* Clavicles (collar bones) */}
                        <path d="M 60 28 Q 65 27 70 28 Q 75 27 80 28" stroke="#B8860B" strokeWidth="0.6" fill="none"/>
                        
                        {/* WIDER ARMS with enhanced detail */}
                        {/* Left shoulder and wider arm */}
                        <circle cx="54" cy="32" r="4" fill="#D4A574" stroke="#B8860B" strokeWidth="0.4"/>
                        <path d="M 50 35 Q 45 42 42 50 Q 38 58 35 65 Q 32 72 30 78" 
                              stroke="#B8860B" strokeWidth="3.5" fill="none" strokeLinecap="round"/>
                        <path d="M 52 35 Q 47 42 44 50 Q 40 58 37 65 Q 34 72 32 78" 
                              stroke="#D4A574" strokeWidth="3" fill="none" strokeLinecap="round"/>
                        
                        {/* Left forearm and elbow */}
                        <circle cx="40" cy="60" r="2" fill="#B8860B" opacity="0.6"/>
                        
                        {/* Left hand */}
                        <ellipse cx="30" cy="80" rx="3" ry="4" fill="#D4A574" stroke="#B8860B" strokeWidth="0.3"/>
                        <path d="M 27 81 L 24 82 M 28 83 L 25 84 M 29 83 L 26 84 M 30 83 L 27 84 M 31 82 L 28 83" 
                              stroke="#B8860B" strokeWidth="0.3"/>
                        
                        {/* Right shoulder and wider arm */}
                        <circle cx="86" cy="32" r="4" fill="#D4A574" stroke="#B8860B" strokeWidth="0.4"/>
                        <path d="M 90 35 Q 95 42 98 50 Q 102 58 105 65 Q 108 72 110 78" 
                              stroke="#B8860B" strokeWidth="3.5" fill="none" strokeLinecap="round"/>
                        <path d="M 88 35 Q 93 42 96 50 Q 100 58 103 65 Q 106 72 108 78" 
                              stroke="#D4A574" strokeWidth="3" fill="none" strokeLinecap="round"/>
                        
                        {/* Right forearm and elbow */}
                        <circle cx="100" cy="60" r="2" fill="#B8860B" opacity="0.6"/>
                        
                        {/* Right hand */}
                        <ellipse cx="110" cy="80" rx="3" ry="4" fill="#D4A574" stroke="#B8860B" strokeWidth="0.3"/>
                        <path d="M 113 81 L 116 82 M 112 83 L 115 84 M 111 83 L 114 84 M 110 83 L 113 84 M 109 82 L 112 83" 
                              stroke="#B8860B" strokeWidth="0.3"/>
                        
                        {/* Hip/Pelvis */}
                        <path d="M 60 68 Q 58 72 60 76 Q 62 78 70 78 Q 78 78 80 76 Q 82 72 80 68" 
                              fill="#D4A574" stroke="#B8860B" strokeWidth="0.5"/>
                        
                        {/* WIDER LEGS with enhanced muscle definition */}
                        {/* Left leg (wider) */}
                        <path d="M 62 78 Q 58 88 56 98 Q 54 108 52 118 Q 50 125 48 130" 
                              stroke="#B8860B" strokeWidth="4" fill="none" strokeLinecap="round"/>
                        <path d="M 64 78 Q 60 88 58 98 Q 56 108 54 118 Q 52 125 50 130" 
                              stroke="#D4A574" strokeWidth="3.5" fill="none" strokeLinecap="round"/>
                        
                        {/* Left knee joint */}
                        <circle cx="56" cy="98" r="2" fill="none" stroke="#B8860B" strokeWidth="0.5"/>
                        
                        {/* Right leg (wider) */}
                        <path d="M 78 78 Q 82 88 84 98 Q 86 108 88 118 Q 90 125 92 130" 
                              stroke="#B8860B" strokeWidth="4" fill="none" strokeLinecap="round"/>
                        <path d="M 76 78 Q 80 88 82 98 Q 84 108 86 118 Q 88 125 90 130" 
                              stroke="#D4A574" strokeWidth="3.5" fill="none" strokeLinecap="round"/>
                        
                        {/* Right knee joint */}
                        <circle cx="84" cy="98" r="2" fill="none" stroke="#B8860B" strokeWidth="0.5"/>
                        
                        {/* Enhanced feet */}
                        <ellipse cx="48" cy="132" rx="4" ry="2" fill="#D4A574" stroke="#B8860B" strokeWidth="0.4"/>
                        <ellipse cx="92" cy="132" rx="4" ry="2" fill="#D4A574" stroke="#B8860B" strokeWidth="0.4"/>
                        
                        {/* Toe details */}                        <circle cx="45" cy="133" r="0.5" fill="#D4A574" stroke="#B8860B" strokeWidth="0.2"/>
                        <circle cx="95" cy="133" r="0.5" fill="#D4A574" stroke="#B8860B" strokeWidth="0.2"/>
                      </g>
                    ) : (
                      <g>
                        {/* BACK VIEW - Enhanced with wider arms and legs */}
                        {/* Head (back of head) */}
                        <ellipse cx="70" cy="12" rx="9" ry="11" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                        
                        {/* Hair/back of head detail */}
                        <path d="M 61 6 Q 70 3 79 6 Q 79 10 77 14 L 63 14 Q 61 10 61 6" 
                              fill="#654321" stroke="#D4AF37" strokeWidth="0.5"/>
                        
                        {/* Neck (back) */}
                        <rect x="66" y="22" width="8" height="6" rx="3" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.3"/>
                        
                        {/* Enhanced back torso with spine emphasis */}
                        <path d="M 58 28 Q 55 35 56 45 Q 57 58 60 68 L 80 68 Q 83 58 84 45 Q 85 35 82 28 Z" 
                              fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                        
                        {/* Spine line (very important for back meridian points) */}
                        <line x1="70" y1="22" x2="70" y2="68" stroke="#B8860B" strokeWidth="2" opacity="0.8"/>
                        
                        {/* Enhanced scapula (shoulder blades) */}
                        <ellipse cx="60" cy="38" rx="6" ry="10" fill="none" stroke="#B8860B" strokeWidth="1" opacity="0.6"/>
                        <ellipse cx="80" cy="38" rx="6" ry="10" fill="none" stroke="#B8860B" strokeWidth="1" opacity="0.6"/>
                        
                        {/* WIDER ARMS (back view) */}
                        {/* Left arm (back) - wider */}
                        <circle cx="54" cy="32" r="4" fill="#D4A574" stroke="#B8860B" strokeWidth="0.4"/>
                        <path d="M 50 35 Q 45 42 42 50 Q 38 58 35 65 Q 32 72 30 78" 
                              stroke="#B8860B" strokeWidth="3.5" fill="none" strokeLinecap="round"/>
                        <path d="M 52 35 Q 47 42 44 50 Q 40 58 37 65 Q 34 72 32 78" 
                              stroke="#D4A574" strokeWidth="3" fill="none" strokeLinecap="round"/>
                        
                        {/* Right arm (back) - wider */}
                        <circle cx="86" cy="32" r="4" fill="#D4A574" stroke="#B8860B" strokeWidth="0.4"/>
                        <path d="M 90 35 Q 95 42 98 50 Q 102 58 105 65 Q 108 72 110 78" 
                              stroke="#B8860B" strokeWidth="3.5" fill="none" strokeLinecap="round"/>
                        <path d="M 88 35 Q 93 42 96 50 Q 100 58 103 65 Q 106 72 108 78" 
                              stroke="#D4A574" strokeWidth="3" fill="none" strokeLinecap="round"/>
                        
                        {/* Hip/Pelvis (back) */}
                        <path d="M 60 68 Q 58 72 60 76 Q 62 78 70 78 Q 78 78 80 76 Q 82 72 80 68" 
                              fill="#D4A574" stroke="#B8860B" strokeWidth="0.5"/>
                        
                        {/* WIDER LEGS (back view) */}
                        {/* Left leg (back) - wider */}
                        <path d="M 62 78 Q 58 88 56 98 Q 54 108 52 118 Q 50 125 48 130" 
                              stroke="#B8860B" strokeWidth="4" fill="none" strokeLinecap="round"/>
                        <path d="M 64 78 Q 60 88 58 98 Q 56 108 54 118 Q 52 125 50 130" 
                              stroke="#D4A574" strokeWidth="3.5" fill="none" strokeLinecap="round"/>
                        
                        {/* Right leg (back) - wider */}
                        <path d="M 78 78 Q 82 88 84 98 Q 86 108 88 118 Q 90 125 92 130" 
                              stroke="#B8860B" strokeWidth="4" fill="none" strokeLinecap="round"/>
                        <path d="M 76 78 Q 80 88 82 98 Q 84 108 86 118 Q 88 125 90 130" 
                              stroke="#D4A574" strokeWidth="3.5" fill="none" strokeLinecap="round"/>
                        
                        {/* Spinal markers for back meridian points */}
                        <circle cx="70" cy="30" r="1" fill="#FFD700" opacity="0.8"/>
                        <circle cx="70" cy="35" r="1" fill="#FFD700" opacity="0.8"/>
                        <circle cx="70" cy="40" r="1" fill="#FFD700" opacity="0.8"/>
                        <circle cx="70" cy="45" r="1" fill="#FFD700" opacity="0.8"/>
                        <circle cx="70" cy="50" r="1" fill="#FFD700" opacity="0.8"/>
                        <circle cx="70" cy="55" r="1" fill="#FFD700" opacity="0.8"/>                        <circle cx="70" cy="60" r="1" fill="#FFD700" opacity="0.8"/>
                      </g>                )}
                
                {/* Render all 362 anatomically accurate pressure points */}
                {getAllPressurePoints().map((point) => {
                  const position = getAnatomicalPosition(point)
                  if (!position) return null
                  
                  const coords = viewSide === 'front' ? position.front : position.back
                  if (!coords) return null
                  
                  const isSelected = selectedPoint && selectedPoint.number === point.number
                  const meridianColor = getMeridianColor(point.meridian)
                  
                  return (
                    <g key={point.number}>
                      <circle
                        cx={coords.x}
                        cy={coords.y}
                        r={isSelected ? 3 : 2}
                        fill={meridianColor}
                        stroke={isSelected ? '#FFD700' : '#FFFFFF'}
                        strokeWidth={isSelected ? 2 : 1}
                        opacity={0.9}
                        className="cursor-pointer transition-all duration-200 hover:r-3 hover:opacity-100"
                        onClick={() => setSelectedPoint(point)}
                      />
                      {isSelected && (
                        <text
                          x={coords.x}
                          y={coords.y - 5}
                          textAnchor="middle"
                          fontSize="3"
                          fill="#FFD700"
                          fontWeight="bold"
                        >
                          {point.number}
                        </text>
                      )}
                    </g>
                  )
                })}
              </svg>

              {/* Region Buttons */}
              <div className="grid grid-cols-2 gap-3 mt-6">
                {Object.keys(bodyRegions).map((region) => {
                  const regionPointCount = getPointsForRegion(region).length
                  return (
                    <button
                      key={region}
                      onClick={() => setSelectedRegion(region)}
                      className="bg-gradient-to-r from-gray-800 to-gray-700 hover:from-yellow-900/30 hover:to-yellow-800/30 border border-gray-600 hover:border-yellow-600 rounded-lg p-4 transition-all duration-200"
                    >
                      <div className="text-yellow-400 font-medium text-sm mb-1">{region}</div>
                      <div className="text-gray-300 text-xs">{regionPointCount} points</div>
                    </button>                  )
                })}
              </div>

              <div className="text-center text-gray-400 text-sm mt-6">
                <p>Tap on a body region to view available points.</p>
                <p className="mt-2 text-yellow-400">
                  <span className="font-semibold">{viewSide.toUpperCase()} VIEW</span>
                  {viewSide === 'back' && <span className="block text-xs mt-1">
                    Great for Bladder & Governing Vessel meridians
                  </span>}
                </p>
              </div>
            </div>
          </div>
        ) : (
            // Individual Region View
            <div className="space-y-6">
              {/* Region Header */}
              <div className="text-center">
                <button
                  onClick={() => setSelectedRegion(null)}
                  className="text-yellow-400 hover:text-yellow-300 mb-4"
                >
                  ← Back to Regions
                </button>
                <h2 className="text-2xl font-bold text-yellow-400 mb-2">{selectedRegion}</h2>
              </div>

              {/* Anatomical Diagram for Region */}
              <div className="relative bg-gray-900 rounded-lg p-6 border border-yellow-600">
                <svg viewBox="0 0 100 100" className="w-full h-64 mx-auto">
                  {/* Region-specific anatomy - keeping original detailed diagrams */}                  {selectedRegion === 'HEAD & NECK' && (
                    <g>
                      {/* Head shape */}
                      <ellipse cx="50" cy="35" rx="18" ry="22" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      {/* Neck */}
                      <rect x="45" y="57" width="10" height="15" rx="3" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      {/* Facial features */}
                      <circle cx="44" cy="30" r="1.5" fill="#8B4513"/>
                      <circle cx="56" cy="30" r="1.5" fill="#8B4513"/>
                      <path d="M 46 40 Q 50 42 54 40" stroke="#8B4513" strokeWidth="1" fill="none"/>                      {/* Hair outline */}
                      <path d="M 35 20 Q 50 15 65 20 Q 65 25 60 30 L 40 30 Q 35 25 35 20" 
                            fill="#654321" stroke="#D4AF37" strokeWidth="0.5"/>
                    </g>
                  )}
                  {selectedRegion === 'ARMS' && (
                    <g>
                      {/* Left arm detailed */}
                      <ellipse cx="25" cy="30" rx="6" ry="18" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      <ellipse cx="20" cy="55" rx="5" ry="15" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      <ellipse cx="18" cy="75" rx="4" ry="8" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      
                      {/* Right arm detailed */}
                      <ellipse cx="75" cy="30" rx="6" ry="18" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      <ellipse cx="80" cy="55" rx="5" ry="15" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      <ellipse cx="82" cy="75" rx="4" ry="8" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                        {/* Joint markers */}
                      <circle cx="25" cy="48" r="2" fill="#B8860B" opacity="0.8"/>
                      <circle cx="75" cy="48" r="2" fill="#B8860B" opacity="0.8"/>
                      <circle cx="20" cy="70" r="1.5" fill="#B8860B" opacity="0.8"/>
                      <circle cx="80" cy="70" r="1.5" fill="#B8860B" opacity="0.8"/>
                    </g>
                  )}
                  {selectedRegion === 'TRUNK' && (
                    <g>
                      {/* Torso with more detail */}
                      <path d="M 35 20 Q 30 35 32 50 Q 35 65 40 75 L 60 75 Q 65 65 68 50 Q 70 35 65 20 Z" 
                            fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      {/* Ribcage outline */}
                      <path d="M 38 25 Q 50 22 62 25 Q 62 35 60 45 Q 50 48 40 45 Q 38 35 38 25" 
                            stroke="#B8860B" strokeWidth="0.8" fill="none" opacity="0.6"/>
                      {/* Spine indication */}
                      <line x1="50" y1="25" x2="50" y2="70" stroke="#B8860B" strokeWidth="1" opacity="0.7"/>
                      {/* Shoulder areas */}
                      <circle cx="35" cy="25" r="3" fill="#B8860B" opacity="0.6"/>
                      <circle cx="65" cy="25" r="3" fill="#B8860B" opacity="0.6"/>                    </g>
                  )}
                  {selectedRegion === 'LEGS' && (
                    <g>
                      {/* Left leg with thigh and calf definition */}
                      <ellipse cx="42" cy="35" rx="6" ry="20" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      <ellipse cx="40" cy="65" rx="5" ry="18" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      
                      {/* Right leg */}
                      <ellipse cx="58" cy="35" rx="6" ry="20" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      <ellipse cx="60" cy="65" rx="5" ry="18" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      
                      {/* Knee joints */}
                      <circle cx="42" cy="55" r="2.5" fill="#B8860B" opacity="0.8"/>
                      <circle cx="58" cy="55" r="2.5" fill="#B8860B" opacity="0.8"/>
                        {/* Hip connection */}
                      <ellipse cx="50" cy="20" rx="8" ry="4" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                    </g>
                  )}
                  {selectedRegion === 'FEET' && (
                    <g>
                      {/* Left foot detailed */}
                      <ellipse cx="35" cy="40" rx="12" ry="6" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      <ellipse cx="30" cy="45" rx="3" ry="2" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                      <ellipse cx="32" cy="48" rx="2" ry="1.5" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                      <ellipse cx="34" cy="50" rx="1.5" ry="1" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                      <ellipse cx="36" cy="52" rx="1.5" ry="1" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                      <ellipse cx="38" cy="53" rx="1.5" ry="1" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                      
                      {/* Right foot detailed */}
                      <ellipse cx="65" cy="40" rx="12" ry="6" fill="#D4A574" stroke="#D4AF37" strokeWidth="1"/>
                      <ellipse cx="70" cy="45" rx="3" ry="2" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                      <ellipse cx="68" cy="48" rx="2" ry="1.5" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                      <ellipse cx="66" cy="50" rx="1.5" ry="1" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                      <ellipse cx="64" cy="52" rx="1.5" ry="1" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                      <ellipse cx="62" cy="53" rx="1.5" ry="1" fill="#D4A574" stroke="#D4AF37" strokeWidth="0.5"/>
                        {/* Ankle areas */}
                      <circle cx="40" cy="30" r="2" fill="#B8860B" opacity="0.6"/>
                      <circle cx="60" cy="30" r="2" fill="#B8860B" opacity="0.6"/>
                    </g>
                  )}
                
                {/* Display points for selected meridian */}
                  {selectedMeridian && getPointsForMeridian(selectedRegion, selectedMeridian).map((point, index) => {
                    const position = getAnatomicalPosition(point)
                    if (!position) return null // Skip points not visible in current view
                    const isSelected = selectedPoint?.id === point.id
                    return (
                      <circle
                        key={point.id}
                        cx={position.x}
                        cy={position.y}
                        r={isSelected ? "3" : "2"}
                        fill={getMeridianColor(point.meridian)}
                        stroke={isSelected ? "#FBBF24" : "#FFFFFF"}
                        strokeWidth={isSelected ? "2" : "1"}                      className="cursor-pointer hover:r-3 transition-all duration-200"
                        onClick={() => handlePointSelect(point)}
                      />
                    )
                  })}
                </svg>

                {/* Selected Point Info */}
                {selectedPoint && (
                  <div className="bg-gradient-to-r from-yellow-900/30 to-yellow-800/30 border border-yellow-600 rounded-lg p-4">
                    <h4 className="font-bold text-yellow-400 text-lg mb-2">
                      {selectedPoint.number} - {selectedPoint.nameEnglish}
                    </h4>
                    <p className="text-gray-300 text-sm mb-4">{selectedPoint.nameRomanized}</p>
                    <button
                      onClick={handleViewPoint}
                      className="w-full bg-gradient-to-r from-red-800 to-red-900 hover:from-red-700 hover:to-red-800 text-white font-bold py-3 px-6 rounded-lg border border-yellow-600"
                    >
                      VIEW POINT
                    </button>
                  </div>
                )}

                <div className="text-center text-gray-400 text-sm">
                  Master your meridians.<br />
                  Restore your power.
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  )
}

export default BodyMap